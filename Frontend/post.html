<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Create Post - Campus Connect</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="feed.css">
  <style>
      body.post-page { overflow-y:auto; min-height:100vh; }
      :root { --creator-accent:#3d6af2; --creator-bg:#121216; --panel-bg:#1b1d23; --panel-border:#2a2d35; }
      .creator-shell { max-width:1400px; margin:0 auto; padding:1rem 1.25rem 2rem; display:flex; flex-direction:column; gap:1rem; }
      .creator-header { display:flex; align-items:center; gap:.75rem; background:var(--panel-bg); border:1px solid var(--panel-border); padding:.75rem 1rem; border-radius:18px; position:sticky; top:0; z-index:10; }
      .creator-header h1 { font-size:1rem; font-weight:600; margin:0; letter-spacing:.5px; }
      .step-indicator { display:flex; gap:.4rem; align-items:center; margin-left:.5rem; }
      .step-dot { width:10px; height:10px; border-radius:50%; background:#2f333b; position:relative; }
      .step-dot.active { background:var(--creator-accent); box-shadow:0 0 0 4px rgba(61,106,242,.2); }
      .creator-header .spacer { flex:1; }
      .btn, .ghost-btn { font:inherit; cursor:pointer; border-radius:10px; padding:.55rem 1rem; font-size:.75rem; font-weight:600; letter-spacing:.5px; display:inline-flex; gap:.5rem; align-items:center; }
      .btn-primary { background:var(--creator-accent); color:#fff; border:1px solid var(--creator-accent); box-shadow:0 4px 14px -2px rgba(61,106,242,.5); }
      .btn-primary[disabled] { opacity:.55; cursor:not-allowed; }
      .ghost-btn { background:#22252b; border:1px solid #30343b; color:#cfd3db; }
      .ghost-btn:hover { background:#292d34; }
      .icon-btn-round { width:40px; height:40px; display:grid; place-items:center; background:#22252b; border:1px solid #30343b; color:#d5d9e2; border-radius:12px; cursor:pointer; }
      .icon-btn-round:hover { background:#2d3138; }
      .creator-main { display:grid; grid-template-columns:1fr 380px; gap:1rem; align-items:stretch; }
      .panel { background:var(--panel-bg); border:1px solid var(--panel-border); border-radius:20px; padding:1rem; position:relative; display:flex; flex-direction:column; min-height:580px; }
      .panel.scroll { overflow:auto; }
  .media-stage { flex:1; display:flex; align-items:center; justify-content:center; position:relative; background:#0d0f13; border-radius:14px; border:1px solid #22252b; overflow:hidden; min-height:clamp(420px, 60vh, 720px); }
  /* Larger height specifically for selection step to give user a generous drop target */
  .select-step .media-stage { min-height:clamp(500px, 65vh, 780px); }
      .media-stage.drag-over { outline:2px dashed var(--creator-accent); outline-offset:-6px; }
      .media-stage .placeholder { text-align:center; color:#6a717d; font-size:.85rem; display:flex; flex-direction:column; gap:.75rem; }
      .media-stage .placeholder i { font-size:2.2rem; opacity:.5; }
      .hidden { display:none !important; }
      input[type=file] { display:none; }
      .select-actions { display:flex; flex-wrap:wrap; gap:.55rem; justify-content:center; }
  .mini { font-size:.7rem; padding:.45rem .85rem; border-radius:999px; background:#262a31; border:1px solid #30343b; color:#cfd3db; cursor:pointer; display:inline-flex; align-items:center; gap:.4rem; }
  .select-actions.below { margin-top:.85rem; justify-content:flex-start; }
      .mini:hover { background:#30343b; }
      .editor-tools { display:flex; gap:.5rem; flex-wrap:wrap; margin-top:.75rem; }
      .editor-tools .tool-btn { flex:1 1 90px; background:#22252b; border:1px solid #30343b; color:#cfd3db; border-radius:12px; padding:.6rem .75rem; font-size:.7rem; display:flex; flex-direction:column; gap:.3rem; cursor:pointer; align-items:center; }
      .editor-tools .tool-btn.active { border-color:var(--creator-accent); box-shadow:0 0 0 2px rgba(61,106,242,.3); }
      .aspect-bar, .filter-bar { display:flex; gap:.5rem; flex-wrap:wrap; margin-top:.6rem; }
      .aspect-btn, .filter-btn { background:#1f2228; border:1px solid #30343b; color:#cfd3db; padding:.5rem .75rem; font-size:.65rem; border-radius:8px; cursor:pointer; position:relative; }
      .aspect-btn.active, .filter-btn.active { background:#2b3139; border-color:var(--creator-accent); color:#fff; }
      .preview-crop-wrapper { width:100%; height:100%; max-height:560px; position:relative; display:flex; align-items:center; justify-content:center; }
      .crop-box { position:relative; overflow:hidden; border-radius:8px; background:#000; cursor:grab; }
  /* Ensure crop-box has a visible size so media can be fitted; width capped responsively */
  /* Crop box now dynamically sized via JS to keep within viewport; start with square fallback */
  /* Fixed-size container so media never changes container dimensions when aspect switches */
  .edit-step .crop-box { width:clamp(300px, 55vmin, 640px); height:clamp(300px, 55vmin, 640px); border:1px solid #22252b; }
  .ratio-frame { position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); border:1px solid rgba(255,255,255,.18); pointer-events:none; }
  .edit-step .preview-crop-wrapper { justify-content:center; }
      .crop-box.dragging { cursor:grabbing; }
  .crop-box img, .crop-box video { position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); max-width:none; max-height:none; -webkit-user-select:none; user-select:none; }
      .filter-none { filter:none; }
      .filter-warm { filter:contrast(1.05) saturate(1.25) sepia(.15); }
      .filter-cool { filter:brightness(1.05) saturate(1.1) hue-rotate(-15deg); }
      .filter-vivid { filter:contrast(1.15) saturate(1.4); }
      .filter-mono { filter:grayscale(1) contrast(1.2); }
      .filter-matte { filter:brightness(.95) saturate(.9) contrast(.95); }
      .sticker-layer { position:absolute; inset:0; pointer-events:none; }
  .sticker { position:absolute; font-size:2.2rem; pointer-events:auto; cursor:move; -webkit-user-select:none; user-select:none; }
  .reel-hint { font-size:.65rem; color:#8b939f; margin-left:.35rem; }
  #statusMsg { min-height:1.2rem; margin-top:.5rem; }
  /* Custom crop overlay */
  .custom-crop-box { position:absolute; border:2px solid rgba(255,255,255,.85); box-shadow:0 0 0 9999px rgba(0,0,0,.55); outline:1px solid rgba(0,0,0,.4); cursor:move; }
  .custom-crop-box.hidden { display:none; }
  .custom-crop-handle { position:absolute; width:14px; height:14px; background:var(--creator-accent); border:2px solid #fff; border-radius:50%; box-sizing:border-box; cursor:grab; }
  .custom-crop-handle:active { cursor:grabbing; }
  .custom-crop-handle[data-pos="tl"] { top:-7px; left:-7px; }
  .custom-crop-handle[data-pos="tr"] { top:-7px; right:-7px; }
  .custom-crop-handle[data-pos="bl"] { bottom:-7px; left:-7px; }
  .custom-crop-handle[data-pos="br"] { bottom:-7px; right:-7px; }
  .custom-crop-handle[data-pos="tm"] { top:-7px; left:50%; transform:translateX(-50%); }
  .custom-crop-handle[data-pos="bm"] { bottom:-7px; left:50%; transform:translateX(-50%); }
  .custom-crop-handle[data-pos="ml"] { left:-7px; top:50%; transform:translateY(-50%); }
  .custom-crop-handle[data-pos="mr"] { right:-7px; top:50%; transform:translateY(-50%); }
      .details-form { display:flex; flex-direction:column; gap:1rem; }
      .details-form textarea { width:100%; background:#14171c; border:1px solid #2a2d35; border-radius:14px; padding:.85rem 1rem; resize:vertical; min-height:140px; font:inherit; color:#e5e8ee; line-height:1.4; }
      .details-form textarea:focus, .details-form input:focus { outline:2px solid var(--creator-accent); outline-offset:2px; }
      .details-form input { width:100%; background:#14171c; border:1px solid #2a2d35; border-radius:12px; padding:.7rem .9rem; font:inherit; color:#e5e8ee; }
      .form-row { display:flex; flex-direction:column; gap:.45rem; }
      .label { font-size:.65rem; letter-spacing:1px; text-transform:uppercase; color:#7d8591; font-weight:600; }
      .hashtag-preview { display:flex; gap:.4rem; flex-wrap:wrap; }
      .tag-chip { background:#1f2329; border:1px solid #31353c; padding:.35rem .6rem; font-size:.6rem; border-radius:999px; color:#b0b7c2; }
      .meta-line { font-size:.6rem; color:#626973; }
      .dual-preview { display:flex; gap:.6rem; align-items:flex-start; }
      .mini-preview-box { width:120px; aspect-ratio:1/1; background:#0d0f13; border:1px solid #22252b; border-radius:10px; position:relative; overflow:hidden; display:flex; align-items:center; justify-content:center; }
      .mini-preview-box img, .mini-preview-box video { max-width:100%; max-height:100%; }
      .sticker-picker { display:flex; gap:.4rem; flex-wrap:wrap; }
      .sticker-btn { background:#22252b; border:1px solid #30343b; padding:.4rem .55rem; font-size:1.25rem; border-radius:10px; cursor:pointer; }
      .sticker-btn:hover { background:#2d3138; }
      .wizard-nav { margin-top:1rem; display:flex; justify-content:space-between; gap:.75rem; }
      .wizard-nav .btn-primary { flex:1; }
      .step-title { font-size:.75rem; letter-spacing:1px; font-weight:600; margin:0 0 .35rem; text-transform:uppercase; color:#7d8591; }
      /* New bottom placement for edit step controls */
      .edit-step { display:flex; flex-direction:column; height:100%; }
      .edit-bottom-bar { margin-top:auto; background:#14171c; border:1px solid #2a2d35; border-radius:16px; padding:.65rem .75rem .8rem; display:flex; flex-direction:column; gap:.55rem; box-shadow:0 6px 28px -10px rgba(0,0,0,.55), 0 0 0 1px rgba(255,255,255,0.03); }
      .edit-bottom-bar .editor-tools { margin-top:0; }
      .edit-bottom-bar .wizard-nav { margin-top:.25rem; }
      @media (max-width:900px){
        .edit-bottom-bar { position:sticky; bottom:0; z-index:5; backdrop-filter:blur(8px); background:rgba(20,23,28,.92); }
      }
      /* Fixed edit layout (desktop) */
      /* Removed fixed editing-mode styles to allow normal page scrolling */
      @media (max-width:1100px){ .creator-main { grid-template-columns:1fr; } .panel { min-height:500px; } }
      @media (max-width:640px){ .creator-header { flex-wrap:wrap; } .creator-main { gap:.75rem; } }
    </style>
  </head>
  <body class="dark-theme post-page">
    <div class="creator-shell">
      <div class="creator-header" id="creatorHeader">
        <button class="icon-btn-round" id="backBtn" title="Back" aria-label="Back to feed"><i class="fas fa-arrow-left"></i></button>
        <h1>Create</h1>
        <div class="step-indicator" id="stepDots" aria-label="Creation steps">
          <span class="step-dot" data-step="0"></span>
          <span class="step-dot" data-step="1"></span>
          <span class="step-dot" data-step="2"></span>
        </div>
        <div class="spacer"></div>
        <button class="ghost-btn" id="saveDraftBtn" type="button"><i class="fas fa-save"></i><span>Save Draft</span></button>
        <button class="btn-primary btn" id="publishBtn" type="button" disabled><i class="fas fa-paper-plane"></i><span>Share</span></button>
      </div>
      <div class="creator-main" id="creatorMain">
        <!-- Left: Media / Editing -->
        <div class="panel" id="mediaPanel">
          <!-- Step 0: Select -->
          <div class="select-step" id="stepSelect">
            <div class="media-stage" id="dropZone" aria-label="Media selection area">
              <div class="placeholder" id="selectPlaceholder">
                <i class="fas fa-cloud-arrow-up"></i>
                <div><strong>Drag & Drop</strong> media here<br/>or use the buttons below</div>
                <input type="file" id="fileInput" accept="image/*,video/*">
              </div>
            </div>
            <div class="select-actions below">
              <button class="mini" id="chooseFileBtn"><i class="fas fa-folder-open"></i><span>Browse</span></button>
              <button class="mini" id="cameraBtn"><i class="fas fa-camera"></i><span>Camera</span></button>
            </div>
            <div class="wizard-nav">
              <button class="btn-primary" id="toEditBtn" type="button" disabled>Next: Edit <i class="fas fa-arrow-right"></i></button>
            </div>
          </div>
          <!-- Step 1: Edit -->
          <div class="edit-step hidden" id="stepEdit">
            <h3 class="step-title">Edit Media</h3>
            <div class="preview-crop-wrapper">
              <div class="crop-box" id="cropBox" data-aspect="1:1">
                <!-- media injected here -->
                <div class="sticker-layer" id="stickerLayer"></div>
                <div class="custom-crop-box hidden" id="customCropBox" aria-label="Custom crop region">
                  <div class="custom-crop-handle" data-pos="tl"></div>
                  <div class="custom-crop-handle" data-pos="tr"></div>
                  <div class="custom-crop-handle" data-pos="bl"></div>
                  <div class="custom-crop-handle" data-pos="br"></div>
                  <div class="custom-crop-handle" data-pos="tm"></div>
                  <div class="custom-crop-handle" data-pos="bm"></div>
                  <div class="custom-crop-handle" data-pos="ml"></div>
                  <div class="custom-crop-handle" data-pos="mr"></div>
                </div>
              </div>
            </div>
          <div class="edit-bottom-bar">
            <div class="aspect-bar" id="aspectBar">
              <button class="aspect-btn active" data-aspect="1:1">1:1</button>
              <button class="aspect-btn" data-aspect="4:5">4:5</button>
              <button class="aspect-btn" data-aspect="16:9">16:9</button>
              <button class="aspect-btn" data-aspect="9:16">9:16</button>
              <button class="aspect-btn" data-aspect="custom">Custom</button>
            </div>
            <div class="filter-bar" id="filterBar">
              <button class="filter-btn active" data-filter="none">Normal</button>
              <button class="filter-btn" data-filter="warm">Warm</button>
              <button class="filter-btn" data-filter="cool">Cool</button>
              <button class="filter-btn" data-filter="vivid">Vivid</button>
              <button class="filter-btn" data-filter="mono">Mono</button>
              <button class="filter-btn" data-filter="matte">Matte</button>
            </div>
            <div class="editor-tools">
              <button class="tool-btn" id="addStickerBtn" type="button"><i class="fas fa-face-smile"></i><span>Sticker</span></button>
              <button class="tool-btn" id="recenterBtn" type="button"><i class="fas fa-crosshairs"></i><span>Center</span></button>
              <button class="tool-btn" id="retakeBtn" type="button"><i class="fas fa-camera-rotate"></i><span>Retake</span></button>
            </div>
            <div class="sticker-picker hidden" id="stickerPicker" aria-label="Sticker choices">
              <button class="sticker-btn" data-sticker="üòÄ">üòÄ</button>
              <button class="sticker-btn" data-sticker="üî•">üî•</button>
              <button class="sticker-btn" data-sticker="üéâ">üéâ</button>
              <button class="sticker-btn" data-sticker="‚ö°">‚ö°</button>
              <button class="sticker-btn" data-sticker="‚ù§Ô∏è">‚ù§Ô∏è</button>
              <button class="sticker-btn" data-sticker="üìö">üìö</button>
            </div>
            <div class="wizard-nav">
              <button class="ghost-btn" id="backToSelectBtn" type="button"><i class="fas fa-arrow-left"></i><span>Back</span></button>
              <button class="btn-primary" id="toDetailsBtn" type="button">Next: Details <i class="fas fa-arrow-right"></i></button>
            </div>
          </div>
          </div>
          <!-- Step 2: Details (left preview small) -->
          <div class="details-step hidden" id="stepDetails">
            <h3 class="step-title">Post Preview</h3>
            <div class="dual-preview">
              <div class="mini-preview-box" id="miniPreview"></div>
              <div class="meta-line" id="metaSummary">Ready to share.</div>
            </div>
            <div class="wizard-nav">
              <button class="ghost-btn" id="backToEditBtn" type="button"><i class="fas fa-arrow-left"></i><span>Edit</span></button>
              <button class="btn-primary" id="shareFromDetailsBtn" type="button">Share <i class="fas fa-paper-plane"></i></button>
            </div>
          </div>
        </div>
        <!-- Right: Details Form -->
        <div class="panel scroll" id="formPanel">
          <div id="stepContextNotice" class="meta-line">Step 1 ¬∑ Select media to continue.</div>
          <form class="details-form" id="detailsForm" autocomplete="off" onsubmit="return false;">
            <div class="form-row">
              <label class="label" for="captionInput">Caption</label>
              <textarea id="captionInput" placeholder="Write a caption with #hashtags..."></textarea>
              <div class="hashtag-preview" id="hashtagPreview"></div>
            </div>
              <div class="form-row">
                <label class="label" for="locationInput">Location</label>
                <input id="locationInput" type="text" placeholder="Add a location" />
              </div>
              <div class="form-row">
                <label class="label" for="songInput">Music / Song</label>
                <input id="songInput" type="text" placeholder="Song title (metadata only)" />
              </div>
              <div class="form-row">
                <label class="label" for="reelToggle">Reel</label>
                <div><input id="reelToggle" type="checkbox" /> <span class="reel-hint">Mark as Reel (vertical video)</span></div>
              </div>
              <div class="form-row" aria-labelledby="stickerLabel">
                <span class="label" id="stickerLabel">Stickers</span>
                <div id="stickerList" class="hashtag-preview meta-line">Added stickers appear here.</div>
              </div>
              <div class="form-row" aria-labelledby="draftLabel">
                <span class="label" id="draftLabel">Draft</span>
                <div class="meta-line" id="draftStatus">No draft saved.</div>
              </div>
              <div class="form-row">
                <button class="btn-primary" id="finalShareBtn" type="button" disabled><i class="fas fa-paper-plane"></i><span>Share Post</span></button>
                <button class="ghost-btn" id="saveDraftBtn2" type="button"><i class="fas fa-save"></i><span>Save Draft</span></button>
              </div>
              <div class="form-row">
                <div class="meta-line">Hashtags and settings are stored as metadata; filters and crop are applied visually (no server-side image processing yet).</div>
              </div>
          </form>
          <div id="statusMsg" class="meta-line"></div>
        </div>
      </div>
    </div>
    <script src="post.js"></script>
  </body>
</html>